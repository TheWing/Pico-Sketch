pico-8 cartridge // http://www.pico-8.com
version 35
__lua__
--plan
--[[
core loop:
 - wake up:
 	 - pack your bag (select books)
 - breakfast:
 	 - improve parent relationship
 	 - ask for permissions
 	 - ask your sibling for help
 	   at school this day
 	 - if you have space in bag,
 	   pack lunch
 - school:
 	 - unpack at your desk
 	 - find other classrooms
 	 - find friends
 	 - do stuff
 	 - each move costs time
 	 - need to be at a desk when
 	   a lesson begins
 	 - if you spend your time 
 	   at the desk through a 
 	   lesson, level up the 
 	   corresponding book
 	   (and get perks?)
 - free time:
 	 - do things with friends
 	   you've made
 	   (basically shopkeepers, 
 	    trainers, whatnot)
 	 - no requirement to be at
 	   desk but must be home
 	   by dinner/night (with perm)
 - dinner: 
 	 - improve parent relationship
 	 - ask for help with schoolwk
 	 - ask for permissions to skip
 	   next dinner to have more
 	   free time the next day
 - night:
 	 - sleep to regain energy
 	 - can still move around home
 	   (or outside if permission)
 	 - must be in bed at least when
 	   it's breakfast again
 - - rinse repeat

 character specs:
 	 speed
 	 	 movement
 	 mental
 	 	 how fast you level up books
 	 cool
 	 	 how quickly you build
 	 	 relationships
 	 	 bullies bully below some
 	 	 cool level
 	 strength
 	 	 health, how much you can
 	 	 carry
 	 bag size
 	 	 just how many separate
 	 	 books you can carry with
 	 	 you
 	 	 (cool goes down if you have
 	 	  a lot of books?)
 
 book specs:
 	 subject
 	 level
 	 unlocked perks
 	 weight

 subjects:
 	 literature
 	 writing
 	 math
 	 geography
 	 physics/chemistry
 	 crafts
 	 arts/music
 	 etc...
 
 
 








--]]
-->8
--main

b=0
bt=0
bp=0
t=0

function _init()
	
end

function _update60()
	b={d=btn(),p=btnp()}
	bt={l=b.d&0b1,r=(b.d&0b10)>>1,u=(b.d&0b100)>>2,d=(b.d&0b1000)>>3,z=(b.d&0b10000)>>4,v=(b.d&0b100000)>>5}
end

function _draw()
	t=t+1
	cls()
	palt()
	draw_room((t\256)%2)
end
-->8
--player
-->8
--room render

room_id=1

room={}

add(room,{id=1,
       tx=0,
       ty=0,
       tw=5,
       th=4,
       base={15,14,▤},--{56,32},
       con={
       {x=1,y=0,r=1,xt=3,yt=3}
       },
       name="bedroom"},
       #room+1)
       
add(room,{id=2,
       tx=5,
       ty=0,
       tw=6,
       th=5,
       base={14,8,▥},--{48,32},
       con={
       {x=1,y=0,r=2,xt=0,yt=0},
       {x=3,y=4,r=0,xt=1,yt=1}
       },
       name="kitchen"},
       #room+1)
       

r={}


function draw_room(id)
	local w,h,x,y,wt,ht
	r=room[id+1]
	w=128
	h=128
	wt=128\r.tw
	ht=128\r.th
	if r.tw>r.th then
		h=128\r.tw*r.th
		ht=128\r.tw
	elseif r.tw<r.th then
		w=128\r.th*r.tw
		wt=128\r.th
	end
	fillp()
	rectfill(0,0,wt*r.tw,ht*r.th-1,r.base[2])
	fillp(r.base[3])
	rectfill(0,0,wt*r.tw,ht*r.th-1,r.base[1])
--	for x=0,r.tw-1 do
--		for y=0,r.th-1 do
--			sspr(r.base[1],r.base[2],8,8,x*wt,y*ht,wt,ht)
--		end
--	end
	palt(11,true)
	palt(0,false)
	smap(r.tx,r.ty,r.tw,r.th,0,0,w,h)
end


-->8
--tiles
-->8
--books
-->8
--utility functions
function smap(cx,cy,cw,ch,sx,sy,sw,sh,flipx,flipy,layers)

 -- negative screen sizes
 if(sw<0)flipx=not flipx sx+=sw
 if(sh<0)flipy=not flipy sy+=sh
 sw,sh=abs(sw),abs(sh)

 -- delta
 local dx,dy=cw/sw,ch/sh

 -- apply flip
 if flipx then
  cx+=cw
  dx=-dx
 end
 if flipy then
  cy+=ch
  dy=-dy
 end

 -- clip
 if(sx<0)cx-=sx*dx sx=0
 if(sy<0)cy-=sy*dy sy=0
 if(sw>128)sw=128
 if(sh>128)sh=128

 -- render with tlines
 -- pick direction that results
 -- in fewest tline calls
 if sh<sw then
  -- horizontal lines
  for y=sy,sy+sh-1 do
   tline(sx,y,sx+sw-1,y,cx,cy,dx,0,layers)
   cy+=dy
  end
 else
  -- vertical lines
  for x=sx,sx+sw-1 do
   tline(x,sy,x,sy+sh-1,cx,cy,0,dy,layers)
   cx+=dx
  end   
 end
end

function altp()
	poke4(0x5f10,0x8382.8180)
	poke4(0x5f10,0x8786.8584)
	poke4(0x5f10,0x8b8a.8988)
	poke4(0x5f10,0x8f8e.8d8c)
end
__gfx__
0000000000044400000440000004400000000044000000000444444011111e88888882774444bbb46666111111111111d551d551ddd6bbbbddd6bbbbbbbbbbbb
0000000000644f0000044000000ff00000044444000000000444444011111e88888882774444bbb46666111111111111d151d1511115bbbbddd5bbbbbbbbbbbb
000000000664ff0000366300006ff60000044444044444400444444011111e88888882774444bbb26666999999996600d151d1511115bbbbddd6bbbbddd6bbbb
00000000065330000065560000333300009444440444444002299220bbbbb222222226664444b4426656999999990066d551d5511115bbbbddd6bbbbddd6bbbb
00000000055330000055550000333300000444220222222002222220bbbbb444444499994444b4426666444444445555d151d1511115bbbbddd6bbbbddd6bbbb
00000000055330000055550000333300000222220222222005000050bbbbb5bbbbbb99992222b2226666444444445005111111111115bbbbddd5bbbbddd5bbbb
00000000000dd000000dd000000dd000000222220222222005000050bbbbbbbbbbbb44445bb5b5b55555444444445555bbbbbbbb1115bbbbddd6bbbbddd6bbbb
00000000000dd000000dd000000dd000000050050500005000000000bbbbbbbbbbbb5bb55bb5bbbbbbbbbbbbbbbbbbbbbbbbbbbb1115bbbbddd6bbbbddd6bbbb
000000000000000000000000000000000000000000000000000000000000000000000000bbbb4bbb00000000bbbbbbbb00000000bbbb6dddbbbb6dddbbbbbbbb
000000000000000000000000000000000000000000000000000000000000000000000000bbbb4bbb00000000bbbbbbbb00000000bbbb5111bbbb5dddbbbbbbbb
000000000000000000000000000000000000000000000000000000000000000000000000bbbb2bbb00000000bbbbbbbb00000000bbbb5111bbbb6dddbbbb6ddd
000000000000000000000000000000000000000000000000000000000000000000000000bbbb244b00000000bbbbbbbb00000000bbbb5111bbbb6dddbbbb6ddd
000000000000000000000000000000000000000000000000000000000000000000000000bbbb244b00000000ddd5ddd500000000bbbb5111bbbb6dddbbbb6ddd
000000000000000000000000000000000000000000000000000000000000000000000000bbbb222b555555551111111100000000bbbb5111bbbb5dddbbbb5ddd
000000000000000000000000000000000000000000000000000000000000000000000000bbbb5b5b555511111111111100000000bbbb5111bbbb6dddbbbb6ddd
000000000000000000000000000000000000000000000000000000000000000000000000bbbbbbbb555511111111111100000000bbbb5111bbbb6dddbbbb6ddd
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
666d666d111d111d66dd1dd666dddd66d6666666666d666d6d6d666d6d6d6d6dbbbbbbbb0000000000000005dbbbbbbdd0000000157777510000000000000000
666d666d111d111d666ddd666d1dd1d6666d6666d666d666d666d666d666d666bbbbbbbb00000000000000510dddddd01d000000157777510000000000000000
666d666d111d111d666ddd6616d66d61666666d66d6d6d6d666d6d6d666d666dbbbbbbbb0000000000000051000000001d000000157777510000000000000000
ddd1ddd1ddd6ddd666dd1dd6116666116d66666666d666d666d666d666d666d6bbbbbbbb0000000000000051000000001d000000bbbbbbbb0000000000000000
666d666d111d111d6dd111dd116666116666d666666d666d6d6d666d6d6d6d6dbbbbbbbb0555555000000051000000001d000000bbbbbbbb0000000000000000
666d666d111d111ddd11111d16d66d616666666dd666d666d666d666d666d666bbbbbbbb5577775500000051000000001d000000bbbbbbbb0000000000000000
666d666d111d111ddd11111d6d1dd1d666d666666d6d6d6d666d6d6d666d666dbbbbbbbb1577775100000051000000001d000000bbbbbbbb0000000000000000
ddd1ddd1ddd6ddd66dd111dd66dddd6666666d6666d666d666d666d666d666d6bbbbbbbb157777510000000500000000d0000000bbbbbbbb0000000000000000
bddddddbbdddddddd0000005dddddddb0000000000000005ddddddddd0000000d000000000000005dddddddbbdddddddbddddddb111111110000000000000000
d0000005d0000000d000000500000005000000000000000500000000d0000000d00000000000000500000005d0000000d0000005111111110000000000000000
d0000005d0000000d000000500000005000000000000000500000000d0000000d00000000000000500000005d0000000d0000005111111110000000000000000
d0000005d0000000d000000500000005000000000000000500000000d0000000d00000000000000500000005d0000000d0000005bbbbbbbb0000000000000000
d0000005d0000000d000000500000005000000000000000500000000d0000000d00000000000000500000005d0000000d0000005bbbbbbbb0000000000000000
d0000005155555551555555155555551555555550000000500000000d0000000155555555555555100000005d000000015555551bbbbbbbb0000000000000000
d0000005111111111111111111111111111111110000000500000000d0000000111111111111111100000005d000000011111111bbbbbbbbd000000000000005
d0000005111111111111111111111111111111110000000500000000d0000000111111111111111100000005d000000011111111bbbbbbbbd000000000000005
fff4fff422242224ff44244fff4444ff24444444444244424242444242424242bbbbbbbb00000000000000059bbbbbb990000000457777540000000000000000
fff4fff422242224fff444fff424424f44424444244424442444244424442444bbbbbbbb00000000000000540999999049000000457777540000000000000000
fff4fff422242224fff444ff2f4ff4f244444424424242424442424244424442bbbbbbbb00000000000000540000000049000000457777540000000000000000
44424442444f444fff44244f22ffff2242444444442444244424442444244424bbbbbbbb00000000000000540000000049000000bbbbbbbb0000000000000000
fff4fff422242224f442224422ffff2244442444444244424242444242424242bbbbbbbb05555550000000540000000049000000bbbbbbbb0000000000000000
fff4fff422242224442222242f4ff4f244444442244424442444244424442444bbbbbbbb55777755000000540000000049000000bbbbbbbb0000000000000000
fff4fff42224222444222224f424424f44244444424242424442424244424442bbbbbbbb45777754000000540000000049000000bbbbbbbb0000000000000000
44424442444f444ff4422244ff4444ff44444244442444244424442444244424bbbbbbbb45777754000000050000000090000000bbbbbbbb0000000000000000
b999999bb9999999900000059999999b0000000000000005999999999000000090000000000000059999999bb9999999b999999b444445440000000000000000
90000005900000009000000500000005000000000000000500000000900000009000000000000005000000059000000090000005444445440000000000000000
90000005900000009000000500000005000000000000000500000000900000009000000000000005000000059000000090000005444445440000000000000000
90000005900000009000000500000005000000000000000500000000900000009000000000000005000000059000000090000005bbbbbbbb0000000000000000
90000005900000009000000500000005000000000000000500000000900000009000000000000005000000059000000090000005bbbbbbbb0000000000000000
90000005455555554555555455555554555555550000000500000000900000004555555555555554000000059000000045555554bbbbbbbb0000000000000000
90000005444445444444454444444544444445440000000500000000900000004444454444444544000000059000000044444544bbbbbbbb9000000000000005
90000005444445444444454444444544444445440000000500000000900000004444454444444544000000059000000044444544bbbbbbbb9000000000000005
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000d000000000000005dddddddbbdddddddbddddddb111111110000000000000000
0000000000000000000000000000000000000000000000000000000000000000d00000000000000500000005d0000000d0000005111111110000000000000000
0000000000000000000000000000000000000000000000000000000000000000d00000000000000500000005d0000000d0000005111111110000000000000000
0000000000000000000000000000000000000000000000000000000000000000d00000000000000500000005d0000000d0000005bbbbbbbb0000000000000000
0000000000000000000000000000000000000000000000000000000000000000d00000000000000500000005d0000000d0000005bbbbbbbb0000000000000000
0000000000000000000000000000000000000000000000000000000000000000155555555555555100000005d000000015555551bbbbbbbb0000000000000000
0000000000000000000000000000000000000000000000000000000000000000111111111111111100000005d000000011111111bbbbbbbbd000000000000005
0000000000000000000000000000000000000000000000000000000000000000111111111111111100000005d000000011111111bbbbbbbbd000000000000005
__gff__
0000000000000000000000000000000000000000000000000000010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010101010101010101010101010000000000000000000000000000000000000001010101010101010101010101000000
0000000000000000000000000000000000000000000000000101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
5f4954545e5f49541a545e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
554d070857554d5d0a0b57000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5509484857554848190957000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4e5656564e554848484857000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000004e56564b564e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7f7469747e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
757d6d7d777f7474747474747e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7568686877757d7d7d7d7d7d7700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6a6868686c6a6868686868687700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
750f681f77756868686868687700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
750e681e77756868686868687700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
750e481e77007676767676760000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
750e681e777f54547e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
750d681d77750c0c770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6a4848486c6a681b770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7568686877007676000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7568686878545454547469747e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
756868687d0c0c0c0c7d6d7d7700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6a68686868686868686868686c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
756868681b1b1b1b1b6868687700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00766b767676767676766b760000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
